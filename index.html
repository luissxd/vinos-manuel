<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>üç∑ Vinos Selectos - Las Vi√±as</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root {
      --color-primario: #8B0000;
      --color-fondo: #f8f4f0;
      --color-texto: #333;
      --radius: 15px;
      --sombra: 0 8px 20px rgba(0,0,0,0.1);
    }
    body { margin:0; font-family:"Segoe UI",sans-serif; background:var(--color-fondo); color:var(--color-texto); }

    /* HEADER + NAV */
    header { background:linear-gradient(135deg,var(--color-primario),#a52a2a); color:#fff; padding:20px; text-align:center;}
    header h1 { margin:0; font-size:2.3rem; }
    nav { display:flex; justify-content:center; gap:20px; padding:15px; background:#fff; box-shadow:var(--sombra);}
    nav a { text-decoration:none; color:var(--color-primario); font-weight:bold; }

    /* HERO SLIDER */
    .hero-slider { position:relative; width:100%; height:280px; overflow:hidden;}
    .hero-slider img { width:100%; height:280px; object-fit:cover; position:absolute; opacity:0; transition:opacity 1s ease-in-out;}
    .hero-slider img.active { opacity:1; }

    /* LOADER */
    #loader {
      position:fixed; top:0; left:0; width:100%; height:100%;
      background:white; display:flex; justify-content:center; align-items:center;
      z-index:999;
    }
    .spinner {
      width:50px; height:50px; border:5px solid #ccc; border-top:5px solid var(--color-primario);
      border-radius:50%; animation:spin 1s linear infinite;
    }
    @keyframes spin { 0%{transform:rotate(0deg);} 100%{transform:rotate(360deg);} }

    /* CONTROLS */
    .controls { display:flex; gap:10px; justify-content:center; padding:15px; background:#fff; box-shadow:var(--sombra); flex-wrap:wrap;}
    .controls select,.controls input { padding:10px; border-radius:var(--radius); border:1px solid #ccc; min-width:150px; font-size:0.95rem;}

    /* CONTAINER + PRODUCT */
    .container { display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:25px; padding:30px;}
    .product {
      background:#fff; border-radius:var(--radius); box-shadow:var(--sombra); overflow:hidden;
      display:flex; flex-direction:column;
      opacity:0; transform:translateY(20px);
      transition:opacity 0.6s ease, transform 0.6s ease;
    }
    .product.show { opacity:1; transform:translateY(0); }
    .product img { width:100%; height:200px; object-fit:cover;}
    .product-content { padding:15px; flex:1; display:flex; flex-direction:column;}
    .product h3 { margin:0; font-size:1.3rem; color:var(--color-primario);}
    .categoria { font-size:0.9rem; opacity:0.7;}
    .descripcion { margin:10px 0; font-size:0.95rem; line-height:1.4;}
    .resena { font-style:italic; font-size:0.9rem; color:#555; margin-bottom:10px;}
    .stars { color:gold; margin:5px 0;}
    .price { font-size:1.2em; color:#b22222; font-weight:bold; margin:5px 0;}
    .add-cart-btn { background:var(--color-primario); color:white; border:none; padding:12px; cursor:pointer; border-radius:var(--radius); transition:0.3s; margin-top:auto;}
    .add-cart-btn:hover { background:#a52a2a; }

    /* FLOATING ICONS */
    .whatsapp-float, .cart-float {
      position:fixed; bottom:20px;
      width:65px; height:65px;
      display:flex; justify-content:center; align-items:center;
      font-size:30px; text-decoration:none; color:white; border-radius:50%;
      box-shadow:0 4px 15px rgba(0,0,0,0.2);
      transition:transform 0.3s ease, box-shadow 0.3s ease;
      z-index:999;
    }
    .whatsapp-float { right:20px; background:#25D366; }
    .cart-float { left:20px; background:var(--color-primario); flex-direction:column; font-size:28px; }
    .whatsapp-float:hover, .cart-float:hover { transform:scale(1.1); box-shadow:0 6px 20px rgba(0,0,0,0.3); }
    .cart-info { font-size:12px; text-align:center; margin-top:3px; }
    .cart-total { font-size:12px; font-weight:bold; }

    /* TOOLTIP */
    .whatsapp-float::after {
      content:"Chatea con nosotros";
      position:absolute;
      bottom:75px; left:50%; transform:translateX(-50%);
      background:#25D366; color:white; padding:5px 10px; border-radius:8px;
      font-size:12px; opacity:0; transition:0.3s;
      white-space:nowrap;
    }
    .whatsapp-float:hover::after { opacity:1; }

    /* TOAST */
    .toast {
      position:fixed; top:-50px; left:50%; transform:translateX(-50%);
      background:var(--color-primario); color:white; padding:12px 20px;
      border-radius:var(--radius); box-shadow:var(--sombra);
      opacity:0; transition:all 0.5s ease;
      font-size:0.95rem;
    }
    .toast.show { top:20px; opacity:1; }

    footer { text-align:center; padding:15px; background:white; margin-top:auto; font-size:0.9rem; opacity:0.7; }
  </style>
</head>
<body>
  <!-- LOADER -->
  <div id="loader"><div class="spinner"></div></div>

  <!-- HEADER -->
  <header>
    <h1>üç∑ Vinos Selectos</h1>
    <p>La experiencia premium para amantes del vino</p>
  </header>

  <!-- NAV -->
  <nav>
    <a href="index.html">Inicio</a>
    <a href="carrito.html">Carrito</a>
  </nav>

  <!-- HERO SLIDER -->
  <div class="hero-slider" id="heroSlider">
    <img src="img/banner1.jpg" class="active" alt="Promo 1">
    <img src="img/banner2.jpg" alt="Promo 2">
    <img src="img/banner3.jpg" alt="Promo 3">
  </div>

  <!-- CONTROLS -->
  <div class="controls">
    <input type="text" id="search" placeholder="Buscar vino...">
    <select id="filterCategory"><option value="Todos">Todas las categor√≠as</option></select>
    <select id="sortBy">
      <option value="default">Ordenar por...</option>
      <option value="precioAsc">Precio: Menor a Mayor</option>
      <option value="precioDesc">Precio: Mayor a Menor</option>
      <option value="estrellasDesc">Mejor Calificados</option>
    </select>
  </div>

  <!-- PRODUCTOS -->
  <div class="container" id="product-list"></div>

  <!-- FLOATING ICONS -->
  <div class="cart-float" onclick="window.location='carrito.html'">
    üõí
    <div class="cart-info">
      <span id="cartCount">0</span> items
      <div class="cart-total" id="cartTotalFloat">S/.0</div>
    </div>
  </div>

  <!-- WHATSAPP FLOTANTE -->
  <a href="https://wa.me/51999999999?text=Hola,%20estoy%20interesado%20en%20sus%20vinos%20üç∑"
   target="_blank" class="whatsapp-float" title="Chatea por WhatsApp">
  <img src="img/wp.png" alt="WhatsApp" style="width:32px;height:32px;">
  </a>

  <!-- TOAST -->
  <div class="toast" id="toast">Producto a√±adido!</div>

  <footer>¬© 2025 Vinos Selectos | <a href="carrito.html">Ver carrito</a></footer>

  <script>
    const whatsappNumber = "51999999999";
    let productosOriginal = [];
    let productosFiltrados = [];

    // SLIDER HERO
    function sliderInit() {
      const slides = document.querySelectorAll("#heroSlider img");
      let idx = 0;
      setInterval(() => {
        slides[idx].classList.remove("active");
        idx = (idx + 1) % slides.length;
        slides[idx].classList.add("active");
      }, 4000);
    }

    // Toast animado
    function showToast(mensaje) {
      const toast = document.getElementById("toast");
      toast.textContent = mensaje;
      toast.classList.add("show");
      setTimeout(() => toast.classList.remove("show"), 2500);
    }

    // Carrito localStorage
    function obtenerCarrito() {
      return JSON.parse(localStorage.getItem("carritoVinos") || "[]");
    }
    function guardarCarrito(c) {
      localStorage.setItem("carritoVinos", JSON.stringify(c));
      actualizarCarritoFlotante();
    }

    // Actualizar contador flotante con total
    function actualizarCarritoFlotante() {
      const carrito = obtenerCarrito();
      const count = carrito.length;
      let total = carrito.reduce((sum, item)=>sum+item.precio,0);
      document.getElementById("cartCount").textContent = count;
      document.getElementById("cartTotalFloat").textContent = `S/.${total}`;
    }

    // Agregar producto
    function agregarAlCarrito(nombre, precio) {
      let carrito = obtenerCarrito();
      carrito.push({ nombre, precio });
      guardarCarrito(carrito);
      showToast(`‚úÖ ${nombre} a√±adido al carrito!`);
    }

    // Animar entrada de productos
    function animateProducts() {
      document.querySelectorAll(".product").forEach((p, i) => {
        setTimeout(()=>p.classList.add("show"), i*100);
      });
    }

    // Render estrellas
    function renderStars(cantidad) {
      return "‚òÖ".repeat(cantidad) + "‚òÜ".repeat(5 - cantidad);
    }

    // Render productos
    function renderProducts(productos) {
      const container = document.getElementById("product-list");
      container.innerHTML = "";
      if (!productos.length) {
        container.innerHTML = "<p style='text-align:center;'>üò¢ No hay vinos para estos filtros</p>";
        return;
      }
      productos.forEach(prod => {
        const div = document.createElement("div");
        div.classList.add("product");
        div.innerHTML = `
          <img src="${prod.img}" alt="${prod.nombre}">
          <div class="product-content">
            <h3>${prod.nombre}</h3>
            <p class="categoria">${prod.categoria}</p>
            <div class="stars">${renderStars(prod.estrellas)}</div>
            <p class="descripcion">${prod.descripcion}</p>
            <p class="resena">${prod.resena}</p>
            <div class="price">S/. ${prod.precio}</div>
            <button class="add-cart-btn" onclick="agregarAlCarrito('${prod.nombre}', ${prod.precio})">‚ûï A√±adir al carrito</button>
          </div>
        `;
        container.appendChild(div);
      });
      animateProducts();
    }

    // Filtros
    function aplicarFiltros() {
      const searchValue = document.getElementById("search").value.toLowerCase();
      const selectedCategory = document.getElementById("filterCategory").value;
      const sortBy = document.getElementById("sortBy").value;

      productosFiltrados = productosOriginal.filter(prod => {
        const matchesName = prod.nombre.toLowerCase().includes(searchValue);
        const matchesCategory = (selectedCategory === "Todos" || prod.categoria === selectedCategory);
        return matchesName && matchesCategory;
      });

      if (sortBy === "precioAsc") productosFiltrados.sort((a,b)=>a.precio-b.precio);
      else if (sortBy === "precioDesc") productosFiltrados.sort((a,b)=>b.precio-a.precio);
      else if (sortBy === "estrellasDesc") productosFiltrados.sort((a,b)=>b.estrellas-a.estrellas);

      renderProducts(productosFiltrados);
    }

    function initCategories() {
      const categoriasUnicas = [...new Set(productosOriginal.map(prod => prod.categoria))];
      const select = document.getElementById("filterCategory");
      categoriasUnicas.forEach(cat => {
        const option = document.createElement("option");
        option.value = cat;
        option.textContent = cat;
        select.appendChild(option);
      });
    }

    // Eventos filtros
    document.getElementById("search").addEventListener("input", aplicarFiltros);
    document.getElementById("filterCategory").addEventListener("change", aplicarFiltros);
    document.getElementById("sortBy").addEventListener("change", aplicarFiltros);

    // Cargar JSON + loader
    window.addEventListener("load", ()=>{
      fetch("vinos.json")
        .then(res => res.json())
        .then(data => {
          productosOriginal = data;
          productosFiltrados = data;
          initCategories();
          renderProducts(data);
          sliderInit();
          actualizarCarritoFlotante();
        })
        .finally(()=>{
          document.getElementById("loader").style.display="none";
        })
        .catch(err => console.error("Error cargando vinos:", err));
    });
  </script>
</body>
</html>
