<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>üõí Tu Carrito | Vinos Selectos</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="icon" type="image/png" href="imagenes/favicon.png">
<link rel="apple-touch-icon" href="imagenes/favicon.png">
<link rel="manifest" href="site.webmanifest">

<style>
  :root {
    --vino: #800020;
    --vino-claro: #a52a2a;
    --dorado: #c8a951;
    --beige: #fffaf5;
  }
  * { box-sizing: border-box; }
  body {
    margin: 0;
    background: linear-gradient(135deg, #faf3ed, #fff8f5);
    font-family: "Segoe UI", sans-serif;
    color: #333;
  }

  /* HEADER */
  header {
    background: linear-gradient(135deg, var(--vino), var(--vino-claro));
    padding: 30px 15px;
    text-align: center;
    color: #fff;
  }
  header h1 {
    margin: 0;
    font-size: 2.3rem;
  }
  header p {
    margin: 5px 0 0;
    opacity: 0.9;
    font-size: 1.05rem;
  }

  /* CARRITO CONTAINER */
  .cart-container {
    max-width: 900px;
    margin: 30px auto;
    background: var(--beige);
    padding: 25px;
    border-radius: 15px;
    box-shadow: 0 6px 18px rgba(128,0,32,0.12);
    animation: fadeIn 0.5s ease;
  }

  /* ANIMACI√ìN ENTRADA */
  @keyframes fadeIn {
    from {opacity: 0; transform: translateY(20px);}
    to {opacity: 1; transform: translateY(0);}
  }

  /* CONTADOR Y PROMO */
  .cart-summary {
    text-align: center;
    margin-bottom: 25px;
  }
  .cart-counter {
    font-size: 1.2rem;
    font-weight: bold;
    color: var(--vino);
    margin-bottom: 10px;
  }
  .promo-msg {
    font-size: 1rem;
    color: #444;
    margin-top: 8px;
  }
  .promo-bar-container {
    background: #eee;
    height: 14px;
    border-radius: 12px;
    overflow: hidden;
    margin-top: 10px;
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
  }
  .promo-bar {
    height: 100%;
    background: linear-gradient(90deg, var(--vino), var(--vino-claro), var(--dorado));
    width: 0%;
    transition: width 0.6s ease;
  }

  /* ITEM CARRITO */
  .cart-item {
    display: grid;
    grid-template-columns: 90px 1fr auto;
    gap: 15px;
    align-items: center;
    background: #fff;
    padding: 12px;
    border-left: 5px solid var(--vino);
    border-radius: 10px;
    margin-bottom: 15px;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    animation: fadeIn 0.4s ease;
  }
  .cart-item:hover {
    transform: scale(1.02);
    box-shadow: 0 4px 12px rgba(128,0,32,0.1);
  }
  .cart-item img {
    width: 80px; height: 100px;
    object-fit: contain;
    border: 1px solid rgba(128,0,32,0.1);
    border-radius: 8px;
    background: #fff;
  }
  .cart-item h3 {
    margin: 0 0 5px 0;
    font-size: 1.1rem;
    color: var(--vino);
  }
  .cart-item .price {
    font-weight: bold;
    color: var(--vino-claro);
    font-size: 1.05rem;
  }
  .cart-item .mini-desc {
    font-size: 0.9rem;
    color: #666;
    font-style: italic;
  }
  .btn-eliminar {
    background: transparent;
    border: none;
    color: var(--vino);
    cursor: pointer;
    font-size: 1.2rem;
    transition: color 0.3s;
  }
  .btn-eliminar:hover {
    color: #ff4444;
  }

  /* TOTAL */
  .cart-total {
    text-align: right;
    font-size: 1.3rem;
    color: var(--vino);
    font-weight: bold;
    margin-top: 25px;
  }

  /* CUPON */
  .coupon-box {
    text-align:center;
    margin-top:15px;
  }
  .coupon-box input {
    padding:10px; 
    border-radius:8px; 
    border:1px solid #ccc;
    width:60%; max-width:300px;
  }
  .coupon-box button {
    padding:10px 15px;
    border:none;
    background:var(--vino);
    color:white;
    border-radius:8px;
    margin-left:5px;
    cursor:pointer;
  }

  /* BOTONES */
  .btn-finalizar {
    background: var(--vino);
    color: #fff;
    padding: 15px;
    border: none;
    border-radius: 12px;
    font-size: 1.2rem;
    margin-top: 20px;
    cursor: pointer;
    width: 100%;
    transition: background 0.3s, transform 0.2s ease;
    box-shadow: 0 4px 10px rgba(128,0,32,0.3);
  }
  .btn-finalizar:hover {
    background: var(--vino-claro);
    transform: scale(1.02);
  }
  .btn-volver {
    display: inline-block;
    text-decoration: none;
    color: var(--vino);
    margin-top: 20px;
    font-weight: bold;
    transition: color 0.3s;
  }
  .btn-volver:hover {
    color: var(--dorado);
  }

  /* EMPTY STATE */
  .empty {
    text-align: center;
    font-size: 1.1rem;
    color: #666;
    padding: 20px;
  }

  /* FOOTER */
  footer {
    text-align: center;
    padding: 25px;
    background: linear-gradient(135deg, #800020, #a52a2a);
    color: #fff;
    font-size: 0.95rem;
  }
  footer img {
    transition: transform 0.3s, filter 0.3s;
  }
  footer img:hover {
    transform: scale(1.2);
    filter: drop-shadow(0 0 5px gold);
  }

</style>
</head>
<body>
  <!-- HEADER -->
  <header>
    <h1>üõí Tu Carrito de Vinos</h1>
    <p>Revisa tus selecciones antes de finalizar</p>
  </header>

  <div class="cart-container">
    <!-- Contador de productos y promo -->
    <div class="cart-summary" id="cartSummary">
      <div class="cart-counter">Tienes 0 vinos en el carrito</div>
      <div class="promo-msg">üí° ¬°Agrega m√°s para aprovechar promociones!</div>
      <div class="promo-bar-container"><div class="promo-bar" id="promoBar"></div></div>
    </div>

    <!-- Items del carrito -->
    <div id="cartContainer"></div>

    <!-- CUPON -->
    <div class="coupon-box">
      <input type="text" id="couponCode" placeholder="¬øTienes un cup√≥n?">
      <button onclick="aplicarCupon()">Aplicar</button>
      <div id="couponMsg" style="margin-top:8px; font-size:0.9rem; color:#444;"></div>
    </div>

    <!-- Total y botones -->
    <div id="cartTotalContainer"></div>
  </div>

  <div style="max-width:900px;margin:0 auto;padding:15px;text-align:right;">
    <a href="index.html" class="btn-volver">‚¨ÖÔ∏è Seguir comprando</a>
  </div>

  <!-- FOOTER -->
  <footer>
    <p>¬© 2025 Vinos Selectos | Experiencia Premium üç∑</p>
  </footer>

  <script>
    const whatsappNumber = "51986973753";
    let cuponActivo = null;
    let descuentoPorcentaje = 0;

    const cuponesDisponibles = {
      "PERU": 20
    };

    function obtenerCarrito(){ 
      return JSON.parse(localStorage.getItem("carritoVinos") || "[]"); 
    }
    function guardarCarrito(c){ 
      localStorage.setItem("carritoVinos", JSON.stringify(c)); 
    }

    function aplicarCupon(){
      const code = document.getElementById("couponCode").value.trim().toUpperCase();
      const msg = document.getElementById("couponMsg");

      if(cuponesDisponibles[code] !== undefined){
        cuponActivo = code;
        descuentoPorcentaje = cuponesDisponibles[code];
        msg.textContent = `‚úÖ Cup√≥n aplicado: ${descuentoPorcentaje}% de descuento`;
        msg.style.color = "green";
      } else {
        cuponActivo = null;
        descuentoPorcentaje = 0;
        msg.textContent = "‚ùå Cup√≥n inv√°lido";
        msg.style.color = "red";
      }
      mostrarCarrito();
    }

    function eliminarDelCarrito(index){
      let carrito = obtenerCarrito();
      carrito.splice(index,1);
      guardarCarrito(carrito);
      mostrarCarrito();
    }

    function finalizarCompra(subtotal, descuento, totalFinal){
      const carrito = obtenerCarrito();
      if(!carrito.length){ 
        alert("Tu carrito est√° vac√≠o üòÖ"); 
        return; 
      }

      let mensaje = "üç∑ *Pedido Vinos Selectos*\n\n";
      carrito.forEach((item, i)=>{
        mensaje += `${i+1}. *${item.nombre}*\n   ${item.descripcion || ""}\n   Precio: S/. ${item.precio}\n\n`;
      });

      mensaje += `üì¶ Subtotal: S/. ${subtotal.toFixed(2)}\n`;
      if(descuento > 0){
        mensaje += `üéüÔ∏è Descuento (${descuentoPorcentaje}% - Cup√≥n *${cuponActivo}*): -S/. ${descuento.toFixed(2)}\n`;
      }
      mensaje += `üí≥ *Total a pagar: S/. ${totalFinal.toFixed(2)}*\n\n`;
      mensaje += `‚úÖ Env√≠ame este mensaje para confirmar tu pedido.`;

      window.open(`https://wa.me/${whatsappNumber}?text=${encodeURIComponent(mensaje)}`, "_blank");
    }

    function mostrarCarrito(){
      const container = document.getElementById("cartContainer");
      const totalContainer = document.getElementById("cartTotalContainer");
      const summary = document.getElementById("cartSummary");
      const promoBar = document.getElementById("promoBar");

      const carrito = obtenerCarrito();
      container.innerHTML = "";
      totalContainer.innerHTML = "";

      if(!carrito.length){
        summary.innerHTML = `<div class="cart-counter">üõçÔ∏è Carrito vac√≠o</div>
        <div class="promo-msg">Agrega vinos para ver promociones</div>
        <div class="promo-bar-container"><div class="promo-bar"></div></div>`;
        container.innerHTML = `<div class="empty">No tienes productos en el carrito</div>`;
        return;
      }

      // Subtotal
      let subtotal = 0;
      carrito.forEach(item=> subtotal += item.precio);
      const cantidad = carrito.length;
      const faltante = 100 - subtotal;
      const porcentajePromo = Math.min((subtotal/100)*100, 100);

      let promoMsg = (subtotal >= 100) 
        ? "‚úÖ ¬°Felicidades! Tienes env√≠o gratis üéâ" 
        : `üöö Agrega S/. ${faltante} m√°s para env√≠o gratis`;

      summary.innerHTML = `
        <div class="cart-counter">Tienes ${cantidad} ${cantidad===1?'vino':'vinos'} en el carrito</div>
        <div class="promo-msg">${promoMsg}</div>
        <div class="promo-bar-container"><div class="promo-bar" id="promoBar"></div></div>
      `;
      setTimeout(()=> promoBar.style.width = porcentajePromo + "%", 100);

      carrito.forEach((item, index)=>{
        const div = document.createElement("div");
        div.classList.add("cart-item");
        div.innerHTML = `
          <img src="${item.img}" alt="${item.nombre}">
          <div>
            <h3>${item.nombre}</h3>
            <div class="mini-desc">${item.descripcion || 'Sin descripci√≥n'}</div>
            <div class="price">S/. ${item.precio}</div>
          </div>
          <button class="btn-eliminar" onclick="eliminarDelCarrito(${index})">‚ùå</button>
        `;
        container.appendChild(div);
      });

      // Descuento
      let descuento = cuponActivo ? (subtotal * descuentoPorcentaje) / 100 : 0;
      let totalFinal = subtotal - descuento;

      const totalDiv = document.createElement("div");
      totalDiv.classList.add("cart-total");
      totalDiv.innerHTML = `
        <div>Subtotal: S/. ${subtotal.toFixed(2)}</div>
        ${descuento > 0 ? `<div style="color:green;">Descuento (${descuentoPorcentaje}%): -S/. ${descuento.toFixed(2)}</div>` : ""}
        <div style="font-size:1.5rem; margin-top:5px;">Total: <strong>S/. ${totalFinal.toFixed(2)}</strong></div>
      `;
      totalContainer.appendChild(totalDiv);

      const btn = document.createElement("button");
      btn.classList.add("btn-finalizar");
      btn.textContent = "‚úÖ Finalizar compra por WhatsApp";
      btn.onclick = ()=> finalizarCompra(subtotal, descuento, totalFinal);
      totalContainer.appendChild(btn);
    }

    window.addEventListener("load", mostrarCarrito);
  </script>
</body>
</html>
